machine:
  files:
    # Spegel compatibility
    - path: /etc/cri/conf.d/20-customization.part
      op: create
      content: |
        [plugins."io.containerd.cri.v1.images"]
          discard_unpacked_layers = false
  sysctls:
    fs.inotify.max_user_instances: "8192"
    fs.inotify.max_user_watches: "1048576"
    net.core.netdev_max_backlog: "4096"
    net.core.rmem_max: "7500000"
    net.core.somaxconn: "65535"
    net.core.wmem_max: "7500000"
    net.ipv6.conf.all.forwarding: "1"
    vm.swappiness: "0"
  install:
    extraKernelArgs:
      - ipv6.disable=0
      - cpufreq.default_governor=performance
  network:
    nameservers:
      # NAT64/DNS64 resolvers - https://nat64.net/
      - 2a01:4f9:c010:3f02::1
      - 2a00:1098:2c::1
      - 2a01:4f8:c2c:123f::1
    disableSearchDomain: true
  time:
    disabled: false
    servers:
      # Use Hetzner NTP servers
      - ntp1.hetzner.de
      - ntp2.hetzner.com
      - ntp3.hetzner.net
      # Fallback to Cloudflare NTP server
      - time.cloudflare.com
  features:
    hostDNS:
      # Doesn't work with Cilium CNI
      forwardKubeDNSToHost: false
  kubelet:
    extraArgs:
      cloud-provider: external
      rotate-server-certificates: "true"
      # Reduce default reserved resources
      kube-reserved: cpu=100m,memory=250Mi,ephemeral-storage=4Gi
      system-reserved: cpu=100m,memory=300Mi,ephemeral-storage=4Gi
    extraConfig:
      serializeImagePulls: false
cluster:
  externalCloudProvider:
    enabled: true
  proxy:
    disabled: true
